#!/bin/bash

DEFAULT_VERSION=v1.2.0

if [ -e .git ] ; then
	VERSION=$(git describe --always --dirty 2>/dev/null)
fi

if [ -z "$VERSION" ] ; then
	VERSION=$DEFAULT_VERSION
fi

if [ ! -f src/version.hh ] || ! grep -q \"$VERSION\" src/version.hh ; then
	echo "#define ROSA_VERSION \"$VERSION\"" > src/version.hh
fi

cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON .
make
